---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Mi Wallet - Recompensas">
  <div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 pt-32 pb-16 px-4">
    <div class="max-w-4xl mx-auto">
      {/* Header */}
      <div class="mb-8 text-center">
        <h1 class="text-4xl md:text-5xl font-black text-gray-800 mb-2">
          💰 Mi Wallet
        </h1>
        <p class="text-gray-600 text-lg">
          Administra tu balance y revisa tus recompensas de cashback
        </p>
      </div>

      {/* Requiere autenticación */}
      <div id="wallet-content">
        <div class="text-center py-12">
          <div class="inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-cyan-500 border-r-transparent"></div>
          <p class="mt-4 text-gray-600">Cargando...</p>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<script>
  import { onAuthStateChanged } from 'firebase/auth';
  import { auth } from '../lib/firebase';

  const walletContent = document.getElementById('wallet-content');

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      // No autenticado - mostrar mensaje y botón de login
      if (walletContent) {
        walletContent.innerHTML = `
          <div class="bg-white rounded-2xl shadow-lg p-8 text-center">
            <svg class="mx-auto w-16 h-16 text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
            </svg>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Inicia sesión para ver tu wallet</h2>
            <p class="text-gray-600 mb-6">Necesitas estar autenticado para acceder a tus recompensas</p>
            <a href="/login" class="inline-block px-6 py-3 bg-gradient-to-r from-cyan-500 to-magenta-500 text-white font-bold rounded-xl hover:shadow-lg transition-all">
              Iniciar Sesión
            </a>
          </div>
        `;
      }
    } else {
      // Autenticado - cargar componente WalletBalance
      if (walletContent) {
        const root = document.createElement('div');
        walletContent.innerHTML = '';
        walletContent.appendChild(root);

        // Cargar React y el componente
        const React = await import('react');
        const ReactDOM = await import('react-dom/client');
        const { default: WalletBalance } = await import('../components/wallet/WalletBalance');

        const reactRoot = ReactDOM.createRoot(root);
        reactRoot.render(
          React.createElement(WalletBalance, {
            showTransactions: true,
            compact: false
          })
        );
      }
    }
  });
</script>
</BaseLayout>
